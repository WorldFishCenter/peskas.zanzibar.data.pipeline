% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/merge-trips.R
\name{match_imei_to_trip}
\alias{match_imei_to_trip}
\title{Match IMEIs to GPS Trips with One-Trip-Per-Day Constraint}
\usage{
match_imei_to_trip(matched, trips)
}
\arguments{
\item{matched}{Data frame of surveys with matched IMEIs (from match_surveys_to_registry)
containing submission_id, landing_date, imei, and boat identifiers}

\item{trips}{Data frame of GPS trips containing trip, imei, ended, and boat identifiers}
}
\value{
Data frame combining all surveys and trips with the following structure:
\itemize{
\item \strong{Matched records}: Survey-trip pairs where both have unique_trip_per_day = TRUE
\item \strong{Unmatched surveys}: Surveys with multiple per day (unique_trip_per_day = FALSE)
\item \strong{Unmatched trips}: Trips with multiple per day (unique_trip_per_day = FALSE)
}

Key columns include:
\itemize{
\item submission_id, landing_date, imei
\item n_fields_used, n_fields_ok, match_ok (from registry matching)
\item trip, started, ended (trip identifiers)
\item registration_number_survey, registration_number_trip (for comparison)
\item boat_name_survey, boat_name_trip
\item fisher_name_survey, fisher_name_trip
\item boat, duration_seconds, range_meters, distance_meters (trip metadata)
}
}
\description{
Joins surveys to GPS trips by IMEI and landing_date, but only creates matches
when there is exactly one survey and one trip per IMEI-date combination.
Records with multiple trips/surveys per day remain unmatched.
}
\details{
The function implements a conservative matching strategy:
\enumerate{
\item Standardizes column names and creates landing_date from trip end times
\item Counts number of surveys and trips per IMEI-date combination
\item Splits data into unique (n=1) and non-unique (n>1) groups
\item Only joins the unique groups (one survey + one trip per day)
\item Combines matched records with all unmatched records
\item Removes internal columns (_clean suffixes, counts, flags)
}

This approach prevents ambiguous matches when multiple trips occur on the same day.
}
\keyword{internal}
